# 질문 내용

### 1. SSR 자료 추가 요청

```BASH
블로그 및 NAVER 자료를 먼저 보고, 토스 자료를 보기
```

1. 먼저 보기

- https://blog.mathpresso.com/suspense-ssr-architecture-in-react-18-ec75e80eb68d
- https://d2.naver.com/helloworld/7804182
- https://d2.naver.com/helloworld/2177909

2. 그 다음에 보기

- https://toss.tech/article/ssr-server
- https://toss.im/slash-22/sessions/1-5

<br />

# `web server` 와 `web application server`

- 내가 `fast api` 로 짠 코드는 `web application server` 임.

## `web server` 란
    
### 현재 이해하고 있는 것

- `분산처리를 한다.` 라는 키워드 (#load balancing #아직, 어떤 원리로 이뤄지는 건지는 모르겠음)

- 분산처리 
    ```bash
    1. fast api 코드로 작성된 파일이 있음 
        1-1 내가 multi threading 관련 코드를 작성하지는 않음 
        1-2 다만, python 내부에서, event loop 를 통해 '동시성' 기능을 만들어둠 
    2. 그걸 '여러개' '실행' 시킨다. (#멀티 프로세싱)
        2-1 왜 여러개를 띄울까? 하나를 띄우는 것보다 왜 효율적일까? ex) 사람들이 많이 올 경우, '서버 내부 스펙을 올리는 것' vs '서버 개수를 늘리기.' 를 비교 했을 때, 서버 개수를 늘리는게 더 빠르고, 사람의 리소스가 더 적게 들어가서?  
    3. 그러면 'process 가 여러개' 나오게 된다. (#❓ 질문 #이때, 동일한 코드의 process 가 여러개 인가? 아니면, 다른 코드로 실행되는 process 가 여러개 인가?)
    4. '놀고 있는 서버' 가 있으면, 그쪽으로 이동하게 한다. 
    ```


### 이해해야 하는 것들
    - `분산 처리` (출처 : https://bit.ly/4gpo1us)
    - `멀티 프로세싱` (출처 : https://bit.ly/4gpo1us)
    - `static` 콘텐체를 serve (출처 : https://yozm.wishket.com/magazine/detail/1780/)
    - 7회차 핵심 (출처 : https://bit.ly/4hFXQRn)

![Image](https://i.imgur.com/eNhH1lA.jpeg)


<br/>

## `web application server` 란?

- [예시-1] (#⭐⭐⭐) : 내가, 아래와 같이 적은, 코드가, Web application server 를 적은 것.
  ![Image](https://i.imgur.com/4Q1BH7v.jpeg)

  - an application server provides an environment where applications can run, no matter what the applications are or what they do. (출처 : https://www.theserverside.com/news/1363671/What-is-an-App-Server)

  - `동적 콘텐츠` 를 serve (출처 : https://bit.ly/4gmFOCM)

  - 기본 기능 (출처: http://bit.ly/4gmFOCM)

    1. 프로그램 `실행환경(environment)` 을 제공
    2. 데이터베이스 접속기능
    3. 여러개의 `트랜잭션` 을 관리한다.
    4. 업무를 처리하는 `비즈니스 로직`




### 예시

1. 프로그램 `실행환경(environment)` 을 제공

```python
from fastapi import FastAPI
from fastapi.responses import FileResponse

app = FastAPI()

# 실행환경 예시: 기본 라우팅 설정@app.get("/")def root():
    return {"message": "home", "status": "200"}
```

2. 데이터베이스 접속 기능 (#postgres 연결)

```python
from sqlalchemy import create_engine, text
from sqlalchemy.orm import sessionmaker

# Postgres 연결 예시: user, password, host, database를 실제 값으로 변경하세요.
DATABASE_URL = "postgresql://username:password@localhost/dbname"
engine = create_engine(DATABASE_URL)
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

@app.get("/db")
def get_db_message():
    db = SessionLocal()
    try:
        result = db.execute(text("SELECT 'Hello from DB' as message")).fetchone()
        return {"db_message": result["message"]}
    finally:
        db.close()
```

3. 두 개의 삽입 쿼리를 하나의 transaction 으로 처리 (#transaction)

```python
@app.post("/transaction")def create_items():
    db = SessionLocal()
    try:
        # 트랜잭션 시작: 두 개의 삽입 쿼리를 하나의 트랜잭션으로 처리
        with db.begin():
            db.execute(text("INSERT INTO example (name) VALUES ('item1')"))
            db.execute(text("INSERT INTO example (name) VALUES ('item2')"))
        return {"status": "Transaction committed"}
    except Exception as e:
        db.rollback()
        return {"status": "Transaction failed", "error": str(e)}
    finally:
        db.close()
```

4. 비즈니스 로직 (#business logic)

```python
@app.get("/calculate")def calculate(a: int, b: int):
    result = a + b  # 비즈니스 로직: 두 수의 합 계산
    return {"a": a, "b": b, "result": result}
```

<br/>

### 궁금한 것 및 생각해 볼 것

- 왜, 내가 짠 코드에는 application 이라는 말이 붙는거지? 그 앞에서 분산처리해주는 서버는 web server 라고 하는 거지?
- `web server`, `web application server` 라고 하는거지?
- `동적 콘텐츠` 와 `정척 콘텐츠` 처리라는 건 어떤 의미인거지?
- `기본 기능` 과 `세부 기능` 에 대해서 구분해서 볼 필요가 있어. 즉, 지금까지 내가 쓴 코드는, 기본적인 WAS 서버 코드 였음. 내가 작성한 코드와 개념 사이에 어떤 관계가 있는지에 대해서, `LINK` 를 해나가야 함.
- 기본 [예시-1] 에서, 1) 데이터 베이스를 연결 시킬 수 있음

# 느낀 것

- process, thread 를 `이미지` 를 활용해서 이해하면, 훨씬 `이해의 속도` 빠르고, `깊이` 가 생긴다는 것을 알게 됨.


```
TIL: 웹 서버, 웹 어플리케이션 서버 

- 웹 서버는 
1) 복수의 PROCESS 를 띄운다. (이게 의미하는게 '멀티 프로세싱') 
2) 그것에 대해서 LOAD BALANCING 하는 기능을 한다. 
3) 멀티 스레딩이란, 그 각각의 프로세스가 멀티 스레드를 IMPORT 해서 동시성을 구현하면, 멀티 스레딩 임 
4) 파이썬, JS 의 경우, EVENT LOOP 가, 동시성 구현을 담당하고 있음. 그래서, 멀티 스레딩은 아님. 그렇지만, 동시성을 구현하고 있음. 그래서, WEB API 를 요청하고 기다리는 동안 다른 뭔가를 할 수 있음 
```

<br/>

# 추가적으로 할 것 (#TODO)

- SSR 자료 정리
- Docker 공부하고, 올려보기
