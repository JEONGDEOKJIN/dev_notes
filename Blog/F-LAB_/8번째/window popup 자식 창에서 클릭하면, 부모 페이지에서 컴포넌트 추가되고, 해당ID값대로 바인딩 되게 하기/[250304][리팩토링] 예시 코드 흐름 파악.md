
# ì‹¤í–‰ íë¦„ íŒŒì•… 
## ìš”ì•½ 
```tsx
// 1. ê°„ê³¼í•˜ê³  ìˆì—ˆë˜ ê²Œ, methods.handleSubmit(onSearch) ğŸ˜¢ğŸ˜¢ğŸ˜¢ğŸ˜¢ğŸ˜¢ğŸ˜¢

// 2. ë¶€ëª¨í˜ì´ì§€ì—ì„œ, 'ìˆ˜ì‹ ì— ì„±ê³µ' í–ˆì„ ë•Œ, 'ì‹¤í–‰í•  í•¨ìˆ˜' ë¥¼ 'ì£¼ì…' í•´ì„œ ì»¨íŠ¸ë¡¤ í•˜ëŠ” ê²ƒ 
	// â­â­â­ ì½œë°±í•¨ìˆ˜ë¡œì¨ ì‹¤í–‰ë˜ê²Œ í•˜ëŠ” ë¡œì§ â­â­â­

```


## 1. Coltable ì—ì„œ Row ë¥¼ ì„ íƒ (#ì´ê²ƒ ë§Œìœ¼ë¡œ ìš°ì„ , event_table ì— ì €ì¥) 
ì¦‰, ì„ íƒí•œ ë°ì´í„°ê°€ methods.getValues("event_table")ì„ í†µí•´ ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ” ìƒíƒœê°€ ë¨.

```tsx
<ColTable
  name="event_table"
  tableKey="event_table"
  className={"w-full mt-4"}
  baseNumber={2}
  columns={tableHeader}
  items={tableData}
  isNumber={false}
  isCheckBox={true}
  isSelectAllLabelShow={false}
  emptyMessage={"ì¡°íšŒ ê²°ê³¼ ê°’ì´ ì—†ìŠµë‹ˆë‹¤."}
  multipleCheck={false}
/>
```

## 2. methods.handleSubmit(onSave) ì—ì„œ 1) ë‚˜ëŠ” onSave ë§Œ ì¼ì„ ê²ƒ ê°™ì€ë°, 2) methods.handleSubmit ë¥¼ ì“´ ì´ìœ  
### handleSubmit ì˜ ì—­í• : validation ì„ ê±°ì³ì„œ -> 1) success, fail ìƒíƒœì— ë”°ë¼ì„œ ë‹¤ë¥´ê²Œ ì‹¤í–‰í•˜ê²Œ í•œë‹¤.
### (#â­â­â­â­â­â­ #ì•„... handleSubmit ì„ ëª°ëë„¤... ã… ã… ã…  #ì§„ì§œ ë‚´ê°€ ì˜ í™œìš©ì„ ëª» í–ˆë„¤... react hook form ì„) 
```bash
ğŸ“Œ Why Use handleSubmit(onSave)?
Ensures Validation
handleSubmit automatically validates the form before calling onSave.

Prepares Clean Data
handleSubmit gives onSave(data), which contains only valid and formatted form values.

Prevents Unintended Execution
Without handleSubmit, onSave runs even if the form is invalid, which is not ideal.

```

## 3. ì„±ê³µí–ˆë‹¤ê³  ê°€ì •í•˜ë©´, 1) handleSubmit ì— ë§¤ê°œë³€ìˆ˜ë¡œ ë„£ì€ onSaveê°€ ì‹¤í–‰ë˜ê³  2) onSave ì•ˆìœ¼ë¡œ, react hook form ì—ì„œ ê´€ë¦¬í•˜ëŠ” ê°’ì´ ì£¼ì…ë¨.
### ê·¸ëŸ¼ ì–´ë–¤ ë°ì´í„°ê°€ ë“¤ì–´ì˜¤ëŠ”ê±´ë°? 
```tsx
react hook form ì˜ ê¸°ë³¸ê°’ ì„¤ì •ì— ë“±ë¡í–ˆë˜ ëª¨ë“  í•„ë“œê°€ ë“¤ì–´ì˜´ (#ì•„ë˜ ì‚¬ì§„ ì°¸ê³ )
```

![Image](https://i.imgur.com/LAdNO4m.jpeg)


### ê·¸ ì¤‘, RHF í•„ë“œ ì¤‘ event_table ì— ìˆëŠ” ê°’ì„ êº¼ë‚¸ë‹¤. 
- (#í…Œì´ë¸”ì—ì„œ event_table ì€ idë¥¼ ì „ë‹¬í•˜ê¸° ë•Œë¬¸ì—, ìˆ«ìë¡œ ë‚˜ì˜¤ê²Œ ë¨)
- (#idê°€ ìˆ«ìë¡œ ë‚˜ì™”ìœ¼ë©´, ì „ì²´ data ì¤‘ì—ì„œ í•´ë‹¹ id ì— ëŒ€í•œê±¸ ì†ì•„ì„œ ë³´ë‚´ì£¼ë©´ ë¨)


## 4. ë³´ë‚´ê³  ì‹¶ì€ ë°ì´í„°ë¥¼ ê²°ì •í•˜ê³ , closeWindow í•¨ìˆ˜ì— ë˜ì ¸ì„œ window.opener.postMessage ë¡œ ë˜ì§„ë‹¤.
### ë³´ë‚´ê³  ì‹¶ì€ ë°ì´í„° ê²°ì •í•˜ê¸° 
```tsx 
  const onSave = (data: any) => {
    console.log("âœ… ì „ì²´ data", data); //  ì—¬ê¸°ì—ì„œëŠ” ì´ì œ, ì „ì²´ react hook form í•„ë“œ ê¸°ë³¸ê°’ì´ ë“¤ì–´ì˜´
    if (data?.["event_table"].length > 0) {
      let selectedEvent = tableData?.find(
        (el) => el.id === data?.["event_table"][0]
      );  // â­â­â­â­â­ ì„ íƒëœ IDë¥¼ ì¶©ì¡±í•˜ëŠ” API DATA ê°€ selectedEvent ê°€ ë¨ 
      
      // ì´ ì•„ë˜ í•¨ìˆ˜ë¡œ ì´ì œ ë§¤ê°œë³€ìˆ˜ë¥¼ ë˜ì§€ê²Œ ë¨ 
      closeWindow({isEventSearch: true, eventName: selectedEvent?.eventName ?? ""});
    }
  };
```

### window.opener.postMessage í™œìš©í•œ í•¨ìˆ˜ì— ë§¤ê°œë³€ìˆ˜ë¡œ ë˜ì§€ê¸° 
```tsx
export function useParentData() {

  const [item, setItem] = useState<any>(undefined);

  useEffect(() => {
    if (typeof window !== "undefined") {
      setItem((window as any)?.data ?? undefined);
    }
  }, []);

  // íŒì—…ì°½ ë‹«ê¸°
  function closeWindow(msg: any) {
    if (typeof window !== "undefined") {
      window.opener.postMessage(msg, window.location.origin);
      window.close();
    }
  }

  return {item, closeWindow};
}
```


## 5. ë¶€ëª¨ì—ì„œ ë°ì´í„° ë°›ê¸°

### 1) window.addEventListener('message', handleMessage) ì—ì„œ handleMessage ì‹¤í–‰
### 2) ë§Œì•½, 'handleReceivedData' ì´ ìˆìœ¼ë©´, ê±°ê¸°ì— ë°ì´í„°ë¥¼ ë„˜ê²¨ì¤€ë‹¤.
### 3) í•µì‹¬ì€, 1) ë§¤ê°œë³€ìˆ˜ë¡œ 'í•¨ìˆ˜' ë¥¼ ë„˜ê²¨ì¤€ë‹¤ëŠ” ê²ƒ 2) ê·¸ë˜ì„œ ë°›ì€ ë°ì´í„°ë¥¼ ë°”ë¡œ ì²˜ë¦¬í•˜ê³  3) RHF ë©”ì„œë“œë¥¼ ì“´ë‹¤ëŠ” ê²ƒ (#â­â­â­)
```tsx
export default function usePopupMessage(
  handleReceivedData: (data: any) => void | undefined
) {

  const [result, setResult] = useState<any>(null);

  useEffect(() => {
    const handleMessage = (event: any) => {
      // 2) ë³´ì•ˆê´€ë ¨ëœ í•„í„°ë§ 
      if (event.origin !== window.location.origin) {
        console.warn('Unknown origin, ignoring message');
        return;
      }
      
      // 3) ì‹¤í–‰ì‹œ, ì™¸ë¶€ì—ì„œ ì£¼ì…ë°›ì€ í•¨ìˆ˜ê°€ ìˆìœ¼ë©´, ì™¸ë¶€ í•¨ìˆ˜ì— event.data ë¥¼ ë„˜ê²¨ì¤€ë‹¤. (#â­â­â­â­â­â­)
      if (handleReceivedData) handleReceivedData(event.data);  
	      // ë§Œì•½, 'handleReceivedData' ì´ ìˆìœ¼ë©´, ê±°ê¸°ì— ë°ì´í„°ë¥¼ ë„˜ê²¨ì¤€ë‹¤.â­â­â­
	      // ì´ê²Œ, 'ì½œë°±í•¨ìˆ˜' ë¡œì¨ ì •ì˜ë˜ê³  ì‚¬ìš©ë˜ëŠ” íë¦„ â­â­â­â­â­â­
      
      setResult(event.data)  
	      // 4) ì´ê±´ ë‚˜ì¤‘ì— ì•„ë˜ì™€ ê°™ì´ ë¹¼ì„œ ì“¸ ìˆ˜ ìˆê²Œ í•˜ê¸° ìœ„í•œ ìš©ë„ 
	      /*
		      const { result } = usePopupMessage((data) => { console.log("Received:", data); });
	      */
		    
    
    };

    window.addEventListener('message', handleMessage);  // 1) ë©”ì‹œì§€ë¥¼ ë°›ìœ¼ë©´, handleMessage ì‹¤í–‰
    return () => {
      window.removeEventListener('message', handleMessage);
    };
  }, []);

  return { result };
}
```


## 6. react hook form ì— ë“±ë¡í•˜ê³  ì‚¬ìš©í•˜ê¸° 

### ë°›ì€ê±¸, eventName í•„ë“œì— ë“±ë¡
```tsx
  usePopupMessage((result: any) => {
    if (result.isEventSearch) {
      methods.setValue("eventName", result.eventName)
    }
  });
```

### ë°›ì€ê±¸, eventName í•„ë“œì— ë“±ë¡ í›„ ì‚¬ìš© 
```tsx
  <Input
    name="eventName"
    type="text"
    disabled
    iconOnClickHandler={onEventSearch}
    searchIconOn
    sizeW="L"
    sizeH="S"
  />
```




```

