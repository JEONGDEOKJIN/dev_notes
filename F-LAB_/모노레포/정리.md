
# 모노레포

## 글의 목표 
```
- 모노레포를 쉽게 이해하고, 연결지어 이해하고, 프로젝트에 적용하고 싶음
```

## '모노레포' 라는 키워드가 나오는 맥락 : 레포지토리 레벨에서의 응집도와 결합도 

```
- 함수, 클래스, 디렉토리, 파일, 레포지토리 등등 다양한 레벨에서 '공통된 코드' 가 있으면, 그것을 '⭐묶어서⭐' 사용하고 싶어 진다. ('공통화' 를 하고 싶어 진다. 공통화된 것의 결과는 '모듈' 이겠지.)

- 이때, 레포지토리에서 동일한 언어가 공유하는 소스 코드를 관리하는 방식 중 하나가 '모노레포' 다. 

- 모노레포 개념이 '응집도&결합도' 개념에서 나온 이유는, 
    레포지토리 간 중복되는 코드를 '공통화' 할 경우, 
        1) '응집도가 낮고, 결합도가 높아' 지게 되기 때문이다. 

- 이렇게 '공통화' 를 하면 소스코드를 적게 쓰는 장점이 있지만, 공통화를 만나게 되는 문제가 있다. 
    1) 공통화된 소스 코드를 사용하는 repo A 에서 특정 기능을 추가 하고 싶지만, 잘못 추가하면 repo B 까지 영향을 받을 수 있다. 그래서 무조건 공통화를 한다고 해서 좋은 건 아니다. (#side effect 이슈⭐⭐)
        EX) 이건, css 에서 진짜 많이 만나게 되는데, 특정 공통 class 를 잘 못 수정해서, 다른 페이지에 있는 컴포넌트가 변경되는 문제를 너무 많이 만났다............. (물론, 응집도, 결합도가 css를 주로 이야기하는 건 아니지만 내가 '피부로 느낀' 문제는 그러했다. )

- 그럼, 'side effect' 를 어떻게 관리할 건 지가 문제가 된다. 
    - 즉, 'side effect 중 dependency' 관리를 어떻게 할 건지가 문제가 된다. 
    - 이때, '각 레포가 공통으로 의존하는 소스 코드 ex) 라이브러리에 대한 관리' 를 해주는 것이 모노레포 툴들 이다. (#⭐⭐⭐⭐⭐)

```


## 시도해 볼 것 
- [ ] 아래 기존 필기를 아직 다 정리 못 함 
- [ ] 공통 모듈을 submodule 또는, turborepo 사용해서 적용해보자 



## 궁금한 것 

1. react 에서도 `side effect` 에 대해 다루고 있는데, 그 side effect 가, 여기 나오는, '공통화 에서 다른 repo 에 예상치 못 한 수정을 가하는 side effect' 를 의미하는 게 맞나? 
```
F-LAB\React\side effect.md 참고
```


---


# 기존 필기


- 연관 개념
    - 응집도, 결합도, 모듈화 (#❓❓❓ 이 모노레포 라는 개념이 왜 응집도, 결합도에서 나온거지?

- 의의
    - `동일한 언어`
    - 각각의 다른 repo 들이 있음
    - 각 repo 간 `공통 코드`가 있음

- 방법
    - monerepo
        - turborepo (monorepo lib)
    - git submodule (#✅ 공통 컴포넌트는, 이걸로 관리할 수 있지 않을까.)
        
        
        - git submodule
            - 레포지 토리를 합치지 않고 dependency 를 관리
            - a repo 에서 b repo 를 사용하는 중 (A REPO ← B REPO)
                - `gitsubmoduleels`
                    - `git submodul init`
                - 다양한 브랜치가 있을 것
                    - 해당 해시의 코드를 받을 수 있음
                - 다른 레포지토리의 코드를 다운 해서 받을 수 있음

- [적용시 고려해야 할 것] ‘코드가 동일하다.’ 라고 해서, 무조건 묶는 것이 좋은가?
    - (반례) 코드가 동일하다고 해도, 묶는 것이 안 좋은 경우
        
        ```jsx
        코드가 동일해도, 각 서비스가 많이 바뀔 수 있음. 
        
        a repo, b repo 모두, 1-dependency 를 참고 하고 있음. 
        
        a repo 에서, 1-dependency 를 변경하고 싶음. 
        그랬을 때, b repo 에도 영향을 미치는 것 임 
        ```
        
    
    - [생각해 볼 것] 이런 느낌은 ‘공통 css’ 도 마찬가지 라는 생각이 듦
        
        ```jsx
        
        - 그러면, A -> B 의 관계에서, 혹은 B <- A 의 관계에서, 
        '사전 실행' 의 관점(DAG 관점) 에서 
        
        - '사용하는 곳' 이라는 키워드 (#⭐⭐⭐⭐⭐⭐) 의 관점에서 봤을 때, 
        	- 사용하는 곳에서 필요해서 고쳤는데, 다른 곳에도 영향을 미친다, 라는 이슈!!!
        	
        - 그러면, '분리' 를 어떤 기준으로 해야 하나? 
        	- CSS 에서의 분리는 뭐지? 
        ```
        

- [질문] 모노레포라는 개념이 왜 `응집도`, `결합도`와 관련된 개념이지?
    - 모노레포로 관리한다는 건, ‘결합도가 높아지는 것’ 왜냐면, 내부에 있던 코드를 외부에서 가져오는 것 이기 때문에. (#❓  맞나)

- 질문
    - “module, yarn, 을 사용하는 이유도 `dependency 를 관리` 하기 위해서“ 라고 하셨는데, `dependency 를 관리` 한다는 건
        - `DAG` 그래프를 통해 `순차적 실행` 되어야 하는 요소의 관계를 파악
        - npm module, yarn 이 해주는 건
            1. 라이브러리 간 dependency 를 DAG 를 통해 관리 
            2. 특정 라이브러리가 업데이트 되면, 그걸 잘 반영하는 역할? 

- CF. DAG : 1) ‘순차적으로 실행’ 되어야 하는 것의 관계를 파악 하는데 도움 되는 graph 2) 라이브러리의 사전 실행시 필요한 공통 라이브러리의 관계를 정리
    
    부모노드는 항상, CHILD 방향으로 EDGE 가 형성됨 
    
    - 이 DAG 구조에 기반하는 컴퓨터 프로그래밍 구조가 많음
        - 컴파일러
        - ALIRFLOW, KUBERFLOW
            - cron job : 주기적인 알람. 숫자값을 설정하면, 매일 주기적으로 울림
            - 주기적인 프로그램을 실행시키는 도구
            - 매일 아침 9시
                - 주기적으로 push 보내려고 할 때 ⭐⭐⭐⭐⭐⭐
                - 이건 cron 문법
                    
                    ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/0cae17fc-ff5c-424e-96d6-f2bfc4d7beb4/a169ce13-0b55-4ea1-a93f-a8936d1a82ea/image.png)
                    
                
            - push
                - 클라우드에서 cron job 설정 가능
            
            - ariflow 할 때
                - 작업을 순차적으로 실행해야 하는 경우가 있음 (#⭐⭐⭐⭐⭐⭐⭐⭐⭐)
        - 순차 실행의 예시
            - 배포 프로세스
                - 코드 → 코드 로컬에서 돌려본다. (반드시 이전 작업이 완료되어야 되는 경우⭐⭐⭐⭐⭐⭐⭐)
                - (위의 것과 병렬적으로) 팀원분들께서 리뷰를 남긴다.
            - DAG 는 `사전 실행` 되어야 하는 것의 관계
                
                ```bash
                처음엔 4개만 실행됨 
                
                ```
                
                ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/0cae17fc-ff5c-424e-96d6-f2bfc4d7beb4/66678aee-c5bd-4d70-8fc4-ffce4a6b1930/image.png)
                
        
        ```bash
        CRON 은 작업 순서를 할 수 없음 
        
        작업 순서를 관리 할 수 있는게 CRON JOB 
        ```
        
    
    ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/0cae17fc-ff5c-424e-96d6-f2bfc4d7beb4/545f027e-d33b-4937-8860-f29ec9c8802f/image.png)
    

- DAG 에서 파생된 flux 관련 궁금증 : 1) 아키텍처 관점 뿐 아니라 하나의 클래스 (service, api 등 전체 흐름의 중간 카테고리 등에서도) , 코드, 관점에서 DAG 가 어떻게 이루어지는가를 알아야 함
    - DAG 를 보니, `flux` 패턴이 생각남
    - 그러면, 이 flux 패턴에서 보이는 `granph` 가 `DAG` 의 일종이 맞는건가 (#❓❓❓)
    - store 관리 (클라이언트 데이터 관리) 에 있어 `flux 패턴`
        - 요즘엔 잘 사용 안 함
        - 왜냐면, redux 가 사장된 거랑 비슷하게, 하나만 변경해도 다른 코드들도 변경해야 해서
        - 단방향 vs 양방향
            - 단방향
                - 관리 편해
                - dependency 를 cycle 형태로 관리하면, 실수할 일이 적어
    - 시사점
        - 전체 아키텍처(?) 레벨이 아니라, 하나의 함수, 하나의 repo 관점에서, 어떻게 작동하는가를 DAG 로 그릴 수 있음.
        - 이것을 어떻게 운영하는가를 고민해야 함.
        - 지금 맥락에서는 ‘graph 에 따라서, 작동 순서가 있고, 이 작동 순서에 따라서 파악하는 과정’ 이 내 코드에는 없었어. 이걸 또한 가져가야 한다는 거 (#⭐⭐⭐⭐⭐ 이게 아키텍처 레벨의 고민인가?)
    



# 궁금한 점 

- '응집도, 결합도' 관리를 'repository level' 에서 진행하는 것이 모노레포 인가? 