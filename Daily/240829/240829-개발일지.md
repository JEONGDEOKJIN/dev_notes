# 주간 회고 포인트

### [storybook 이 필요한 이유] 지금 필요한 공통 컴포넌트를 빠르게 찾을 수 있다. 나 뿐 아니라 함께 작업하는, 새롭게 투입된 개발자분들도 -> 그러면 팀의 효율성이 높아진다.

1. 내가 필요로 하는 건, input 검색창에서 아래로 떨어지는거. -> 이걸, 공통 컴포넌트 일일이 코드를 넣으면서 찾아볼 수 없다 -> storybook 안에서, 그게 가능한 코드가 뭔지를 '시각적' 으로 확인하면 -> '일일이 코드' 를 넣지 않고 빠르게 찾을 수 있다.

![Image](https://i.imgur.com/aroHwG8.png)

### 디바운싱을 유지하니까 안 돌아갔던 코드 (@240827)

### 내가 해야 하는 건, '실무 task를 해결' 하면서도, '이론적으로 깊이 있게' 공부하는 것

1. 정제된 학습을 위해서는, '구조화된 지식' 이 있어야 함
2. '구조화된 지식' 이 있는 상태에서 -> 그걸 말로써 체득 해야 함.

- 이 시간이 1시간? 2시간?

### 나에게 야근은 어떤 의미인가. 생각해보자.

### 무리한 일정

- 그 모든 것을 다 하려고 하지 말자.
- 그 안에서, 내가 맡은 일, 그것의 120%의 성장. 그것에만 신경쓰자.
- 뭐라고 하면, 그냥, 신경 끄자.
- 다만, 확실하게 해야 할 건, 120% 의 성장.
  - 핑계를 댄다면, 댈 수 있다. 하지만, 그렇다고, 현재 나의 부족한 실력 까지 덮을 수는 없다.
  - 지금 현재의 나를 인정하고 받아들이자.

### 내가 이해한 흐름 ( #changeEntries 의 핵심 : `DB 에서 true, false` 인 값을 -> 화면에 렌더링 할 때, `적절한 텍스트로 맵핑` 하는 것 )

### DB 에서 넘어온 값을 수정할 때, 이거 말고 좀 더 세련된 방법 없을까나 (#회원목록조회 관련)
- 내가 부족한 거 ( #⭐⭐⭐ 여기에서 변환하는거 완전히 소화 못 함)
```jsx 
      // [기존코드] 백엔드 연결시 ⭐⭐⭐⭐⭐
      const {
        data: { code, data }, // ⭐⭐⭐⭐⭐ code 로 분기처리해야함
      } = await UserService.getUsers(param)

      if (code === 200) {
        const processedData = {
          ...data,
          items: data.items.map((item) => ({
            ...item, // 나머지 필드는 동일
            create_at: item.create_at.replace("T", " "), // "T"를 공백으로 대체
          })),
        };
        setData(processedData);
      }
    } catch (e) {
      handleError({ e, alert });
    }
  }, []);
```

### methods 객체가 모든 것을 알고 있는 이유 
- 3.1 '정렬' 하는 라디오 버튼을 눌렀을 때, 일어나는 일들 
```jsx
{/* 
  1) Radio 버튼에서 
  selectUser2 객체에서, value 가 true 인 '탈퇴' 를 누르면 -> DB 의 quited 필드 중 'true' 인 게 -> changeEntrie 를 거쳐서 -> '탈퇴|회원???' 으로 보임
  
  2) Radio 컴포넌트에서 
    - items props 로 name="quite" 가 들어간다. 
    - register 메서드의 매개변수로 name 이 들어간다. 
        <input
          id={label}
          type="radio"
          value={value}
          disabled={disabled}
          {...register(name, rules)} 
          className={classNames(
            HiddenInputConfig,
            !disabled && "cursor-pointer "
          )}
        />
    
    3) 그 다음? 

    4) '조회' 를 클릭 -> onSearch 메서드로 넘어감 -> onSearch 안의 data 에는, date, 검색 키워드 등이 들어감 
      - 현재 form 이 관리하는 모든게 들어가나?
      - 이걸 넘겨주는 건 form 인가?  

        a) useForm 을 사용해서, 초기값을 등록했고 -> 결과를 methods 객체가 갖고 있음.⭐⭐⭐⭐⭐⭐
          const methods = useForm<FormInput>({
            mode: "onBlur",
            defaultValues: {
              searchType: "",
              keyword: "",
              quited: "",
              date: {
                start_at: past1Month, // 현재로 부터 1달전
                end_at: today, // 오늘 날짜
                period: "1개월",
              },
              page: 1,
            },
          }); 
        b) 따라서, methods 객체는 등록한 값들의 정보를 모두 알고 있음.
      
    5) 그리고 getUpdateData 로 해당 데이터를 전부 넘김 (#⭐⭐⭐)
      - updatedParams 를 만들고 1) session 에 저장 2) 넘겨야 하는 payload 정리하고 3) getData 로 api 를 태운다.
      - 그러면, setData 로 상태변수 data 에 저장한다. 
      - 이 data 가 Table 컴포넌트의 data 속성으로 들어간다.
    

*/}
```


---


### 조금의 시간이지만, 그 순간 많이 배웠다는 생각이 든다. 







# 앱 메뉴 구성 에서 URL 변경 (#20분 정도 소요 #원래 처음에 좀 더 했어야 하는)

- 해야 하는 것 
```
현재, 스프레드시트에서의 url 과 실제 들어가지는 url 을 같게 
왜냐면, 이걸 하면, 한번에 빠르게 파악이 되기 때문.
우선, 완료!  
```

![Image](https://i.imgur.com/0zeQY2q.png)

![Image](https://i.imgur.com/QdWmgfU.png)



# 401 에러 나면 -> refresh token 던지고, access token 받는걸로! ( #우선, 오늘 이슈 전달하고, 커뮤니케이션 때문에 시간이 많이 지체 되었다. 이건 다음으로 넘기고, API 붙이는거 오늘까지 마무리 하자)

- 문제 상황 
```
access token 만료 -> refresh 를 못 던져주니까 -> 401 이 되어서 -> 로그인이 튕김 
```
![Image](https://i.imgur.com/2Z3gcdG.png)

- 할일 정리 
```bash
1. 현재 refresh token 을 받고 있는지 확인 

2. refresh 가 잘 저장되고 있는지 확인 (#access token 이랑 저장되는 위치가 달랐던거 같은데, 왜냐면, fo 코드랑 합치면서 # 그러면, 한 군데에서 저장하는 게 나으려나 #우선, 코드 관리상, access 랑 동일하게 넣자)

3. 만료 되었을 때, 잘 꺼내지고 있는지 확인 

4. api 에 refresh 가 잘 담기는지 확인 

5. return 으로 access 가 잘 저장되어서 로그인이 연장되는지 확인 
  - 이거는 이제, '실제 token 명을 비교' 하면 될 듯 
```

### 1) 현재 백엔드에서 refresh token 을 잘 받고 있나 

```
우선, 잘 받고 있음
```

![Image](https://i.imgur.com/gYZTgFN.png)

이게 local storage 에 저장 








# 회원 목록 조회 


### 1. DB 조회시 내려오는 필드명에 맞게 , 1) Database의 header 2) 필요시 page 의 entries 변수 -> 추가 확인 필요 3) changeEntries 하는 key 값 변경 
![Image](https://i.imgur.com/EJb9Ksh.png)


- 추가로 input name? 


### 2. '기간 조회' (#🔵 작동)

![Image](https://i.imgur.com/6ftPIzY.png)

- 이슈 
```
가입 일시 시점
```
![Image](https://i.imgur.com/Yj7RhPM.png)


- 내가 부족한 거 ( #⭐⭐⭐ 여기에서 변환하는거 완전히 소화 못 함)
```jsx 
      // [기존코드] 백엔드 연결시 ⭐⭐⭐⭐⭐
      const {
        data: { code, data }, // ⭐⭐⭐⭐⭐ code 로 분기처리해야함
      } = await UserService.getUsers(param)

      if (code === 200) {
        const processedData = {
          ...data,
          items: data.items.map((item) => ({
            ...item, // 나머지 필드는 동일
            create_at: item.create_at.replace("T", " "), // "T"를 공백으로 대체
          })),
        };
        setData(processedData);
      }
    } catch (e) {
      handleError({ e, alert });
    }
  }, []);
  
```


### 3. 정렬



- 3.1 '정렬' 하는 라디오 버튼을 눌렀을 때, 일어나는 일들 
```jsx


    <PageLayout>
      <FormProvider {...methods}>
        <SearchFilter
          optionContent={
            <>
              <FilterOption
                title="기간"
                content={<DatePickerContainer name="date" isTotal={true} />}
              />

              <FilterOption
                title="정렬"
                content={<Radio name="quited" items={selectUser2} />}
              />

{/* 
  1) Radio 버튼에서 
  selectUser2 객체에서, value 가 true 인 '탈퇴' 를 누르면 -> DB 의 quited 필드 중 'true' 인 게 -> changeEntrie 를 거쳐서 -> '탈퇴|회원???' 으로 보임
  
  2) Radio 컴포넌트에서 
    - items props 로 name="quite" 가 들어간다. 
    - register 메서드의 매개변수로 name 이 들어간다. 
        <input
          id={label}
          type="radio"
          value={value}
          disabled={disabled}
          {...register(name, rules)} 
          className={classNames(
            HiddenInputConfig,
            !disabled && "cursor-pointer "
          )}
        />
    
    3) 그 다음? 

    4) '조회' 를 클릭 -> onSearch 메서드로 넘어감 -> onSearch 안의 data 에는, date, 검색 키워드 등이 들어감 
      - 현재 form 이 관리하는 모든게 들어가나?
      - 이걸 넘겨주는 건 form 인가?  

        a) useForm 을 사용해서, 초기값을 등록했고 -> 결과를 methods 객체가 갖고 있음.⭐⭐⭐⭐⭐⭐
          const methods = useForm<FormInput>({
            mode: "onBlur",
            defaultValues: {
              searchType: "",
              keyword: "",
              quited: "",
              date: {
                start_at: past1Month, // 현재로 부터 1달전
                end_at: today, // 오늘 날짜
                period: "1개월",
              },
              page: 1,
            },
          }); 
        b) 따라서, methods 객체는 등록한 값들의 정보를 모두 알고 있음.
      
    5) 그리고 getUpdateData 로 해당 데이터를 전부 넘김 (#⭐⭐⭐)
      - updatedParams 를 만들고 1) session 에 저장 2) 넘겨야 하는 payload 정리하고 3) getData 로 api 를 태운다.
      - 그러면, setData 로 상태변수 data 에 저장한다. 
      - 이 data 가 Table 컴포넌트의 data 속성으로 들어간다.
    

*/}
```


![Image](https://i.imgur.com/0txzkfT.png)


- 정렬 문의 사항 
@해인 해인 개발자님 안녕하세요. 
BO 회원관리 목록 검색 관련 문의사항 전달드립니다. 
https://bit.ly/3Z5ZvJU 참고 부탁드립니다. 
감사합니다~! 



# 회원 등급 생성 

### 1. 필드명 설정 (#✅✅✅✅✅ 이게 신경 쓰이네 )


### 2. 우선, 기획서가 안 나와서 '수정' 으로 넘어가기 (240829-1630)



# 회원 정보 수정 
### 1. 수정은 어떻게 진행이? 

- 그러려면, `user > [id] > page` 로 들어가야 함 
  - 아, 기존에는, 페이지 전환이었는데, 지금은, alert 창으로 변경되었음. 

- onEdit 여기를 타야 함 
```jsx 
  // 수정
  const onEdit = (data: any) => {
    const { user_nickname } = data;
    const params = {
      nickname: user_nickname,
    };
    const alertData = {
      content: "해당 회원을 수정하시겠습니까?",
      isCancel: true,
      callback: () => patchData(nowId, params),
    };
    alert.openAlert(alertData);
  };
```



### 2. page 에 있던 로직은 modal 창 안에서 이루어지게 수정 

1. 데이터 가져오기 -> 문제는 "이 유저의 ID 가 무엇인가?" 를 알아내는 것. 

```jsx

    // 데이터 가져오기
    const getData = useCallback(async (id) => {
      try {
        const {
          data: { code, data },
        } = await UserService.getUser(id);
        if (code === 200) {
          methods.reset({
            ...data,
            user_phone: formatPhone(data.user_phone),
            total_fanart_post: format3comma(data.total_fanart_post),
            total_community_post: format3comma(data.total_community_post),
            total_comment: format3comma(data.total_comment),
          });
        }
      } catch (e) {
        handleError({ e, alert });
      }
    }, []);

    useEffect(() => {
      getData(nowId);
    }, [getData, nowId]);

```

2. 해당 유저의 id 를 가져와야 하는데 이건, token 파싱을 통해 가져오기 

```jsx
// 해당 코드를 token manager로 옮기기
export const getUserInfoFromToken = (): ParsedJwtToken => {
  const {
    payload: { email = "", nickname = "" },
  } = getParsedJwtToken();
  const [userId] = email.split("@");

  return {
    email,
    userId,
    nickname,
  };
};
```

3. 오캐이 해당 유저의 데이터를 가져왔음 

```jsx
    // 데이터 가져오기
    const getData = useCallback(async (id) => {
      try {
        const {
          data: { code, data },
        } = await UserService.getUser(id);

        console.log("수정 getData data", data);
    }}
```

4. 이제 그걸 뿌려주기 (#read)

- 4.1  form 의 `특정 필드` 에, `받아온 데이터` 를 `바인딩` 하기 
```jsx
        if (code === 200) {
          methods.reset({
            ...data,
            user_phone: formatPhone(data.user_phone), // form 의 user_phone 필드에 formatPhone(data.user_phone) 값을 바인딩
            total_fanart_post: format3comma(data.total_fanart_post),
            total_community_post: format3comma(data.total_community_post),
            total_comment: format3comma(data.total_comment),
          });
        }

```

- 4.1 `필드 이름` 과 `input 태그의 name 이름` 이 동일하면, input 태그에 보여지게 됨 
![Image](https://i.imgur.com/SF5K22J.png)


![Image](https://i.imgur.com/EDleZQJ.png)


![Image](https://i.imgur.com/pzm3tjM.png)



- 4.2 input 에서 원하는 걸로 넣었어 -> 그 다음에, `수정하기!` 버튼을 누른다. 

![Image](https://i.imgur.com/cO0ily5.png)



5. 그러면, onEdit 함수가 실행됨 -> 그러면, 업데이트 하고 싶은 값을 params 에 담으면 됨 ⭐⭐⭐⭐⭐⭐ 

```jsx
  // 수정
  const onEdit = (data: any) => {
    const { user_nickname } = data;

    // ⭐⭐⭐ 다른 정보를 추가 하고 싶으면, params 안에 key 가 들어가야 함  
    const params = {
      nickname: user_nickname,
    };
    const alertData = {
      content: "해당 회원을 수정하시겠습니까?",
      isCancel: true,
      callback: () => patchData(8, params), // [✅TODO] nowId 는 현재, 8 로 하드코딩
      // callback: () => patchData(nowId, params),
    };
    alert.openAlert(alertData);
  };

```



6. 이제 `수정 가능한 필드` 랑, `보여줘야 하는 필드` 를 구분해서 진행하기 



7. input 이 아니라, `토글` 에서 기존 값이 보이게 하기 (#⭐⭐⭐)
![Image](https://i.imgur.com/pHssyeh.png)


8. `FormSelect` 안에서 바인딩된 텍스트가 보이는 곳
```jsx
  <div className="flex justify-between items-center">
    <span className="text-ellipsis overflow-hidden whitespace-nowrap">
      {/* 현재 버튼에서 보여지는 값 | Update 시, get 한 데이터가 이곳에 꽂혀야 함 */}
      {items?.find((i) => i.value === selectValue)?.label}
    </span>
    <div
      className={classNames(
        "flex-shrink-0",
        showOptions
          ? "bg-[url('/img/icon/downArray.svg')] w-[14px] h-[14px]"
          : "bg-[url('/img/icon/select.svg')] w-[11px] h-[7px]"
      )}
    ></div>
```


### 버튼에서 값이 보여지는 로직을 다시 정리하면 (#⭐⭐⭐⭐⭐)

1. `{items?.find((i) => i.value === selectValue)?.label}` 이곳인데 

1) i.value 이건 selectUserTest 여기에서의 value 에 바인딩된 값
```bash

  export const selectUserTest = [
  {
    label: "탈퇴",
    value: true, 
  },
  {
    label: "유지",
    value: false,
  },
];
```

- 왜냐면, `selectUserTest` 여기로 목차가 전달이 됨  

```jsx
<RowModalTableLarge
  data={[
    {
      value: (
        <FilterOption
          title="quited 필드 변경"
          content={
            <FilterBox
              selectItems={selectUserTest} // ⭐⭐⭐ 목차 전달
              selectName="quited"
              inputName="keyword"
              onSearch={methods.handleSubmit(onSearch)}
            />
          }
        />
      ),
    }]}
```


2) selectValue 이건, 현재 `quited` 의 form 에 바인딩 되어 있는 값 
```jsx
  const selectValue = getValues(name); 
  여기에서 온 값 
```

```bash
현재 id 8 번의 quited 값이 false 이므로, const selectValue = getValues(name) 값은 false 가 나옴  

# 근데, 모든 quited 의 값이 아니라, id=8 인 것의 quited 가 나오는거지
```


3) value 가 같을 때 -> label 이 보임!!! 





### 그러면, 현재 시점에서 해야 할 것은 

1. `수정 필요한 필드` 와 `보여줘야 하는 필드` 간 구분이 필요한데, `수정` 필드는 quited 등으로 임시로 변경될 수 있게 해놔야 할 듯 


2. 현재 div 에, 현재 data 값을 바인딩 해서 넣기 
![Image](https://i.imgur.com/vqpMcED.png)


3. 현재 여기에서, DB 에서 받은 EMAIL 을, form 을 통해 넣어주려면? (#⭐⭐⭐⭐⭐ #이게 지금 어려움) 
![Image](https://i.imgur.com/ykrcVZe.png)



4. 현재, 값이 `undefined` 으로 나오는데, 그 이유는, form 에 등록된 디폴트 값이 다르기 때문?!

```jsx
{
    "channel_name": "",
    "channel_image": [],
    "description": "",
    "original_link": ""
}
```

![Image](https://i.imgur.com/QDyuOwe.png)


---

## 문제상황 정리 (#⭐⭐⭐⭐⭐)

### 1. 수정해야 하는 컴포넌트와 조회해야 하는 컴포넌트간 구분히 필요함. 

### 2. 현재, 그냥 조회만 하는 컴포넌트가 잘 작동을 안 함 

- 2.1 `TextBox` 에 inputName prop 을 던지면, TextBox 에서 받아야 하는데 못 받고 있음. 
```jsx
  {
    value: (
      <FilterOption
        title="이름"
        content={<TextBox inputName = "user_email" fontWeight="500" content="정덕진" />}
      />
    ),
    required: true,
  }
```

- 2.2 여기에서 못 받음
```jsx
  const { getValues } = useFormContext();
  /*
    1. form 으로 감싸져 있는지 확인 
    2. 그러면, getValues 로 접근할 수 있음. 
    3. name 을 받아서 getValues(name) 으로 접근하면 됨 
    4. 전체는 해당 name 필드의 값이, API 타고 난 다음, 바로 form 에 들어갔어야 함
  */

  console.log("inputName" ,inputName )

  const selectValue = getValues(inputName);
  console.log("getValues selectValue | data", selectValue);

```