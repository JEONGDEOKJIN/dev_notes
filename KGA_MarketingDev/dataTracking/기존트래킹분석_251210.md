# Meta Pixel 트래커

Meta(Facebook) Pixel 이벤트 추적을 위한 컴포넌트 모음입니다.

## 폴더 구조

```
meta-pixel/
├── index.tsx          # 모든 컴포넌트 export
├── meta-pixel.tsx     # Meta Pixel 스크립트 초기화 (서버 컴포넌트)
├── trackers.tsx       # 이벤트 트래커 컴포넌트들 (클라이언트 컴포넌트)
└── README.md          # 문서
```

## 컴포넌트 구조

```
MetaPixel (meta-pixel.tsx)
└── Meta Pixel SDK 스크립트 삽입 및 초기화
    └── fbq('init', 'PIXEL_ID')
    └── fbq('track', 'PageView')

MetaPixelTracker (trackers.tsx) - 내부 컴포넌트
├── ViewContentTracker        # 페이지/콘텐츠 조회 추적
├── CompleteRegistrationTracker  # 회원가입 완료 추적
└── CustomEventTracker        # 커스텀 이벤트 추적
```

## 사용법

### 1. 기본 Import

```tsx
import {
  ViewContentTracker,
  CompleteRegistrationTracker,
  CustomEventTracker,
} from "@/app/(shared)/lib/meta-pixel";
```

### 2. ViewContentTracker - 페이지 조회 추적

```tsx
const MyPage = () => {
  return (
    <>
      <ViewContentTracker pageKey="my-page" />
      {/* 페이지 내용 */}
    </>
  );
};
```

### 3. CompleteRegistrationTracker - 회원가입 완료 추적

```tsx
const SignupCompletePage = () => {
  return (
    <>
      <CompleteRegistrationTracker pageKey="signup-complete" />
      <h1>회원가입이 완료되었습니다!</h1>
    </>
  );
};
```

### 4. CustomEventTracker - 커스텀 이벤트 추적

```tsx
// 기본 사용
<CustomEventTracker
    eventName="Lead"
    pageKey="counsel-page"
/>

// 파라미터와 함께
<CustomEventTracker
    eventName="ViewContent"
    pageKey="unity-course"
    parameters={{
        content_name: 'Unity 게임 개발 과정',
        content_category: 'game-development',
        value: 3000000,
        currency: 'KRW'
    }}
/>
```

## Props

### ViewContentTracker / CompleteRegistrationTracker

| Prop      | Type     | Required | Description                                   |
| --------- | -------- | -------- | --------------------------------------------- |
| `pageKey` | `string` | No       | 중복 방지용 고유 키 (미지정 시 이벤트명 사용) |

### CustomEventTracker

| Prop         | Type                                                   | Required | Description         |
| ------------ | ------------------------------------------------------ | -------- | ------------------- |
| `eventName`  | `string`                                               | Yes      | Meta Pixel 이벤트명 |
| `pageKey`    | `string`                                               | No       | 중복 방지용 고유 키 |
| `parameters` | `Record<string, string \| number \| boolean \| Array>` | No       | 추가 파라미터       |

## Meta Pixel 표준 이벤트 목록

| 이벤트명               | 용도        | 설명                         |
| ---------------------- | ----------- | ---------------------------- |
| `ViewContent`          | 페이지 조회 | 특정 페이지나 콘텐츠 조회 시 |
| `Lead`                 | 리드 생성   | 상담 신청, 문의 등           |
| `CompleteRegistration` | 회원가입    | 회원가입 완료 시             |
| `Contact`              | 연락        | 연락처 제출 시               |
| `Schedule`             | 예약        | 일정/상담 예약 시            |
| `SubmitApplication`    | 지원        | 지원서/신청서 제출 시        |
| `Purchase`             | 구매        | 결제 완료 시                 |
| `AddToCart`            | 장바구니    | 장바구니 담기 시             |
| `InitiateCheckout`     | 결제 시작   | 결제 페이지 진입 시          |
| `Search`               | 검색        | 검색 실행 시                 |

## 중복 방지 메커니즘

1. **useRef**: 컴포넌트 리렌더링 시 중복 발송 방지
2. **sessionStorage**: 같은 세션 내 동일 페이지 재방문 시 중복 발송 방지

```
사용자 첫 방문 → 이벤트 발송 → sessionStorage 저장
사용자 재방문 → sessionStorage 확인 → 이벤트 발송 안 함
새 세션 시작 → sessionStorage 초기화 → 이벤트 발송
```

## 적용 예시

### 코스 페이지별 적용

```tsx
// Unreal 5 페이지
<ViewContentTracker pageKey="unreal-5-page" />

// Unity 페이지
<ViewContentTracker pageKey="unity-page" />

// 웹개발 페이지
<ViewContentTracker pageKey="web-dev-page" />

// 3D 모델링 페이지
<ViewContentTracker pageKey="3d-modeling-page" />
```

### 전환 퍼널 추적

```tsx
// 1. 코스 페이지 조회
<ViewContentTracker pageKey="unreal-5-page" />

// 2. 상담 신청 페이지
<CustomEventTracker eventName="Lead" pageKey="unreal-5-counsel" />

// 3. 신청 완료
<CompleteRegistrationTracker pageKey="unreal-5-complete" />
```
