# 결함 설명

- '자궁경부암' 의 경우, '필수' 문항임 -> so, 자궁경부암 하위 문항이 모두 처리가 되어야 -> 버튼 활성화가 되어야 함

# 현재 상황 및 결함의 원인

- 이 '필수 여부' 를 확인할 수 있는 필드는? : inqyMdcsMninYn (#ocs 상 약물알러지와 위암내시경이 다른 값으로 내려옴을 근거로 알 수 있음)
- 현재, ocsRequire 필드에 대해서 필수처리가 안 되어 있음.
  : 필수 항목 로직은 나중에 결함 처리할 때 마무리 하자는 논의가 나왔었고, 이게 지금 시점임(#즉, 시간에 쫓겨 미룸 #그렇게 지시가 내려옴)
- 답변은 트리구조로 되어 있음.

  - 필수 항목으로 지정된게 클릭이 되면 -> 해당 항목의 하위 질문들을 모두 클릭해야 -> 첫 번째 항목의 validation 이 ok 가 되는 구조
  - 만약, 첫 번째 항목의 답변 타입이 '복수형체크박스' 라면, 여러개를 선택해도 clear 되는 구조

- 데이터를 받아옴 -> rhf 에 담김
  -> OCS필수여부 필드에 따라서 -> OCSRequiredList 에 담김
  -> 각 항목에 대해서 클릭이 됨
  -> key-value 가 들어옴
  -> 전체 RHF 에서 entries 가 뽑혀옴
  -> 그러면, 각 key 에 대해서 -> 어떠한 next 질문이 필요한지를 알 수 있음.

  -> rhf 에서, 1) 답변 유형과 2) 질문 에 따라서 3) 체크 되었는지를 파악할 수 있음.

# 결함의 근본 원인

- 문진을 구성할 때,
  1.  필수 문항, 뎁스, 에 대해서 반영이 안 되었음.

# 내가 한 조치

- [v] 우선, 답변 유형 상관없이, 종단노드까지 클릭이 되었을 때, 가장 상위의 부모가 true 가 되는 건 확인 (#250807)

- [ ] 타입별로 true 가 체크되는 상황을 다시 컨트롤 해야 함 (#주관식, 체크박스 별로)
      : [ ] '답변 유형 === 예/아니오' 일 때, '아니오' 클릭시 valid true 되게 만들기

- [ ] GE1, GE1_1 은 이것대로 체크가 되고, BE1, BE_1 이건 또 자신의 직계 가족대로 체크가 될 수 있게 해야 함

- [ ] 답변 저장하는 RECOIL 이 가장 최근의 것으로 덮어쓸 수 있게 관리하기

- reachable 변수를 만들어서, 선택된 변수와 관련된 next 질문만 판단하기 
	: 이때, RHF 데이터가 아니라 API 데이터 기반으로 판단할 수 있게 ROOT 질문 변경하기 

# 괜찮았다고 생각되는 점 (좋았던 점)

- 타입을 적용하니, 목표가 명확해짐. 오타에서 오는 디버깅 시간 단축. 사이드 이펙트에 대한 걱정 줄어드는 느낌
- 하나의 질문코드가 valid 인지 여부를 판단하는 건 하나의 함수에서 담당. 이것을 저장하는 건 다른 함수에 위임. (#단일 책임 원칙)

# 구체적으로 예상하지 못 했던 것 (#내가 구체적으로 무엇을 몰랐나.)

- 뒤에서 collectQuestionActiveStates가 부모 GBC1을 자식 미응답 기준으로 다시 false로 세팅을 예상하지 못 했음
  : 순차적으로 isQuestionAnswered -> collectQuestionActiveStates 가 실행되어서 collectQuestionActiveStates 의 값이 activeMap 을 덮어쓸거라 예상을 못 함. 그러면 왜 덮어쓴거지? -> 이걸 방지하기 위해서 activeMap[q.inqyQstnCd] === undefined 일 때 만 실행되게 해서, '최초 1회' 만 실행되게 함

# 앞으로 시간을 줄이려면

- 지금 GCC1 질문 코드의 '예' 답변의 nextInqyQstnCdCtn 값에, GCC1*2, GCC1_3 이 모두 걸려있다는 사실을 간과 했다 -> 그래서, 나는 '내가 원하는 대로 동작해주길 (무의식 중에) 기대' 그걸 위해서 계속 왜 안 될까 생각했다. 그런데, 'GCC1*예' 답변의 nextInqyQstnCdCtn 필드가 GCC1_2, GCC1_3 이것을 바라보고 있으니, '전체' 를 클릭해야 들어가는 건 당연한 거 였다. (#이 코드가 의미하는 것 뿐 아니라, #API 데이터 구조 자체가 의미하는 것을 쉽게 설명할 수 있게 이해하고 있어야 한다.)

- 그리고 자신감을 갖고 하자. 자신감을 가질 수 있는 환경에 나를 던지자. 그 배움을 통해 나는 자신감이 있어 라고 할 수 있을 만큼 연습을 하자.

- 문제 자체를 설명하는 것에 대해서, 시간을 아까워 하지는 말라.

- 문진 로직이 사실, DFS 를 사용할 수 있다는 걸 알게 되었다. 알고리즘을 공부해서 적용하면 안정적인 개발을 할 수 있다는 걸 알게 되었다. 해보자. 

# 추가 공부하면 좋을 것

-     if (!resp.nextInqyQstnCdCtn) continue; 이 부분에 대한 이해
