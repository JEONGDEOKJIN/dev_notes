<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    
    <div>

        <h1>게시글 수정</h1>
        
        <input type="text" id="titleInput" placeholder="제목을 입력하세요.">

        <!-- [✅TODO] disabled 가 뭐지 : 사용자가 수정할 수 없음-->
        <input type="text" id="authorInput" placeholder="작성자" disabled >
    
        <textarea id="contentInput" placeholder="내용을 입력하세요"></textarea>
        <input type="text" id="imageInput" placeholder="이미지 URL 을 입력하세요.">
        
        <button id="updateBtn"  >수정 완료</button>
        <button id="cancelBtn"  >취소</button>
    </div>

    <script>
        // [✅TODO] 좋은 질문입니다! location.search는 URL의 쿼리 문자열 부분을 가져오기
        var search = location.search; 
        var postId = search.split('=')[1]; // [✅TODO] 숫자 인덱스 1로 나누는 것 보다, KEY 값으로 구분하는게 향후 더 정확할 수 있음.

        var savedPosts = localStorage.getItem('posts')
        var posts = savedPosts ? JSON.parse(savedPosts) : [];

        var currentPost = null // 찾은 게시글 저장할 변수 
        var currentPostIndex = -1 // 찾은 게시글의 위치(인덱스)를 저장할 변수 // // 아직 못 찾음 (-1)

        // 전체 post 중 일치하는 게시글을 currentPost에 넣기
        for(var i = 0; i < posts.length; i++){
            if(posts[i].id === Number(postId)){
                currentPost = posts[i]
                currentPostIndex = i
                break;
            }
        }

        if(!currentPost){
            alert('게시글을 찾을 수 없습니다.')
            location.href = 'list.html'
        }

        // 기존 값으로 바인딩 하기
        document.querySelector('#titleInput').value = currentPost.title
        document.querySelector('#authorInput').value = currentPost.author
        document.querySelector('#contentInput').value = currentPost.content
        document.querySelector('#imageInput').value = currentPost.image

        // 수정 완료 버튼 클릭시 new post 저장 
        var updateBtn = document.querySelector('#updateBtn')
        updateBtn.addEventListener('click', function(){
            var newTitle = document.querySelector('#titleInput').value;
            var newContent = document.querySelector('#contentInput').value;
            var newImage = document.querySelector('#imageInput').value;
            
            if(newTitle === '' || newContent === '' ){
                alert('제목과 내용을 입력해주세요.');
                return
            }

            // post 배열에 new post 추가
            posts[currentPostIndex].title = newTitle
            posts[currentPostIndex].content = newContent
            posts[currentPostIndex].image = newImage

            localStorage.setItem('posts' , JSON.stringify(posts))

            alert('수정되었습니다!')
            location.href = `detail.html?id=${postId}`
        })

        // 취소 버튼 
        var cancelBtn = document.querySelector('#cancelBtn');
        cancelBtn.addEventListener('click', function(){
            location.href = `detail.html?id=${postId}`
        })

    </script>

</body>
</html>